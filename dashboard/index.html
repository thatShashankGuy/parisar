<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="//unpkg.com/alpinejs" defer></script>
    <script>
        let ENV = "PROD"
        let BASEURL = "http://127.0.0.1:3000/admin/v1/"

        if (ENV === "PROD") {
            BASEURL = "https://oveeil9e47.execute-api.ap-south-1.amazonaws.com/Prod/admin/v1/"
        }



        async function uploadAudio() {
            const file = document.getElementById('file-input').files[0]
            if (file) {
                try {
                    const response = await fetch(`${BASEURL}upload-broadcast`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            fileName: file.name
                        })
                    })
                    const data = await response.json();
                    fetch(data.url, {
                        method: "PUT",
                        body: file
                    }).then(response => {
                        if (response.ok) {
                            alert("successfully uploaded")
                        } else {
                            alert("something went wrong")
                        }
                    }).catch(e => console.log("error::", e))
                } catch (error) {
                    console.log(error.message)
                }
            } else {
                console.log(file);
                alert("NO FILE SELECTED")
            }
        }

        async function getAudioInfo() {
            try {
                const response = await fetch(`${BASEURL}broadcast`, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                    }
                })
                let data = await response.json()

                return data
            } catch (error) {
                console.log(error.message)
                return []
            }
        }


        function tableComponent() {
            return {
                data: [],
                init() {
                    getAudioInfo().then(r => this.data = r).catch(e => console.log(e))
                }
            }
        }

        function broadcastSubmissionHandler() {
            return {
                podcastNo: '',
                title: '',
                episodeId: '',
                submitForm() {
                    console.log('Submitting form...');
                    console.log('Podcast No:', this.podcastNo);
                    console.log('Title:', this.title);
                    console.log('Episode ID:', this.episodeId);

                    // submission logic to be code
                }
            }
        }


    </script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <title>Admin Dashboard</title>
</head>

<body class="bg-gray-100">
    <h1 class="text-5xl font-bold-monospace text-center text-purple-800 p-6">Admin Dashboard</h1>
    <div class="max-w-6xl mx-auto p-6 bg-gray-200 shadow-lg">
        <h2 class="text-3xl font-bold-monspace text-left text-purple-800">Audio Panel</h2>
        <div x-data="tableComponent()" class="p-6">
            <table class="min-w-full leading-normal">
                <thead>
                    <tr>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Name
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Size
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Last Modified
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Delete
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Download
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <template x-for="item in data" :key="item.name">
                        <tr>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <div class="flex items-center">
                                    <div class="ml-3">
                                        <p class="text-gray-900 whitespace-no-wrap" x-text="item.name"></p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <p class="text-gray-900 whitespace-no-wrap"
                                    x-text="(item.size/1048576).toFixed(2) + ' MB'"></p>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <p class="text-gray-900 whitespace-no-wrap" x-text="item.last_modified"></p>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <button type="button" class="
                                px-4 py-2 bg-purple-800 hover:bg-red-700 
                                rounded text-white 
                                focus:outline-none">delete</button>
                            </td>
                            <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                                <button type="button" class="
                                px-4 py-2 bg-purple-800 hover:bg-green-700 
                                rounded text-white 
                                focus:outline-none">download</button>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>


    </div>
    <!--Broadcast DB  PANEL-->
    <div class="max-w-6xl mx-auto p-6 bg-gray-200 shadow-lg">
        <h2 class="text-3xl font-bold-monspace text-left text-purple-800">Broadcast DB Panel</h2>
        <div x-data="" class="p-6">
            <table class="min-w-full leading-normal">
                <thead>
                    <tr>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Podcast ID
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Episode
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Title
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Last Modified
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Delete
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Download
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <template>
                        <tr>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
    <!--FEED BACK PANEL-->
    <div class="max-w-6xl mx-auto p-6 bg-gray-200 shadow-lg">
        <h2 class="text-3xl font-bold-monspace text-left text-purple-800">Feedback Panel</h2>
        <div x-data="" class="p-6">
            <table class="min-w-full leading-normal">
                <thead>
                    <tr>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Email
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Comment
                        </th>
                        <th scope="row"
                            class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                            Last Modified
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <template>
                        <tr>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
    <!--Update Meta Data and Audio PANEL-->
    <div class="max-w-6xl mx-auto p-6 bg-gray-200 shadow-lg">

        <div x-data="broadcastSubmissionHandler()" class="max-w-md">
            <form @submit.prevent="submitForm" class="bg-grey  px-8 pt-6 pb-8 mb-4">
                <p class="text-2xl font-bold-monspace 
                text-left 
                text-purple-800">
                    Add Podcast Meta Data</p>
                <div class="mb-4">
                    <label for="podcast-no" class="text-l 
                    font-bold-monspace 
                    text-left">Podcast #</label>
                    <input type="text" name="podcastNo" id="podcast-no" x-model="podcastNo" class="shadow appearance-none 
                    border rounded 
                    w-full py-3 px-3 
                    text-gray-700 
                    leading-tight 
                    focus:outline-none 
                    focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label for="title-id" class="text-l 
                    font-bold-monspace 
                    text-left">Title</label>
                    <input type="text" name="title" id="title-id" x-model="title" class="shadow appearance-none 
                    border rounded 
                    w-full py-3 px-3 
                    text-gray-700 
                    leading-tight 
                    focus:outline-none 
                    focus:shadow-outline">
                </div>
                <div class="mb-6">
                    <label for="episode-id" class="text-l 
                    font-bold-monspace 
                    text-left">Episode #</label>
                    <input type="text" name="episodeId" id="episode-id" x-model="episodeId" class="shadow appearance-none 
                    border rounded 
                    w-full py-3 px-3 
                    text-gray-700 
                    leading-tight 
                    focus:outline-none 
                    focus:shadow-outline">
                </div>
                <div class="flex items-center justify-between">
                    <button class="bg-purple-800 hover:bg-purple-700 
                    text-white 
                    py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                        Submit
                    </button>
                </div>
            </form>
        </div>

        <div x-data="{file : null}" class="p-6">
            <input type="file" accept=".mp3" name="latest 
                    audio file" @change="file = $event.target.files[0]" id="file-input" class="p-6 text-stone-500
                    ">
            <button type="button" @click="uploadAudio()" id="upload-button" class="px-4 py-2 bg-purple-800 hover:bg-purple-700 
                        rounded text-white 
                        focus:outline-none" :disabled="!file">
                Upload Mp3
            </button>
            <br>
            <span x-show="!file" class="text-lg text-purple-500 text-right">*No file selected</span>
        </div>
    </div>
</body>

</html>